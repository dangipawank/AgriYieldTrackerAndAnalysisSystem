<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Full Yield Report</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <h1>Full Yield Report</h1>

    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %} {% for category, message in messages %}
    <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %} {% endif %} {% endwith %}

    <form method="GET" class="filter-form">
      <label for="year">Year:</label>
      <select id="year" name="year">
        <option value="">All</option>
        {% for yr in years %}
        <option value="{{ yr }}">{{ yr }}</option>
        {% endfor %}
      </select>

      <label for="crop_id">Crop:</label>
      <select id="crop_id" name="crop_id">
        <option value="">All</option>
        {% for crop in crops %}
        <option value="{{ crop.CropId }}">{{ crop.CropName }}</option>
        {% endfor %}
      </select>

      <label for="district_id">District:</label>
      <select id="district_id" name="district_id">
        <option value="">All</option>
        {% for d in districts %}
        <option value="{{ d.districtid }}">{{ d.districtname }}</option>
        {% endfor %}
      </select>

      <label for="season_id">Season:</label>
      <select id="season_id" name="season_id">
        <option value="">All</option>
        {% for s in seasons %}
        <option value="{{ s.seasonid }}">{{ s.seasonname }}</option>
        {% endfor %}
      </select>

      <button type="submit">Apply Filters</button>
      <a href="{{ url_for('main.full_yield_report') }}">Reset</a>
      <a
        href="{{ url_for('main.export_full_report', file_format='csv', year=selected_year, crop_id=selected_crop_id, district_id=selected_district_id, season_id=selected_season_id) }}"
        >Export CSV</a
      >
      <a
        href="{{ url_for('main.export_full_report', file_format='excel', year=selected_year, crop_id=selected_crop_id, district_id=selected_district_id, season_id=selected_season_id) }}"
        >Export Excel</a
      >
    </form>

    {% if report_data %}
    <table>
      <thead>
        <tr>
          {% for col in columns %}
          <th>{{ col }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for row in report_data %}
        <tr>
          {% for col in columns %}
          <td>{{ row[col] }}</td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p>No report data found for the selected filters.</p>
    {% endif %}

    <script>
      const selectedYear =
        "{{ selected_year if selected_year is not none else '' }}";
      const selectedCrop =
        "{{ selected_crop_id if selected_crop_id is not none else '' }}";
      const selectedDistrict =
        "{{ selected_district_id if selected_district_id is not none else '' }}";
      const selectedSeason =
        "{{ selected_season_id if selected_season_id is not none else '' }}";

      if (selectedYear) {
        document.getElementById("year").value = selectedYear;
      }
      if (selectedCrop) {
        document.getElementById("crop_id").value = selectedCrop;
      }
      if (selectedDistrict) {
        document.getElementById("district_id").value = selectedDistrict;
      }
      if (selectedSeason) {
        document.getElementById("season_id").value = selectedSeason;
      }
    </script>

    <br />
    <a href="{{ url_for('main.dashboard') }}">Back to Dashboard</a>
  </body>
</html>
